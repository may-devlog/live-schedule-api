# ローカル開発環境設定

## 挙動が異なる理由

### 本番環境とローカル環境の違い

**本番環境（Fly.io）:**
- `DISABLE_AUTH=true` 環境変数が設定されている
- `/public/schedules` エンドポイントは**全てのスケジュール**を返す（`is_public`の条件を無視）

**ローカル環境:**
- `DISABLE_AUTH` 環境変数が設定されていない
- `/public/schedules` エンドポイントは**`is_public = 1`のスケジュールのみ**を返す

### 解決方法

ローカル環境でも本番環境と同じ挙動にするには、`DISABLE_AUTH`環境変数を設定してください。

#### 方法1: 環境変数を直接設定（推奨）

```bash
cd backend
export DISABLE_AUTH=true
cargo run
```

#### 方法2: .envファイルを作成（推奨）

`backend/.env`ファイルを作成して、以下の内容を記述してください：

```
DISABLE_AUTH=true
DATABASE_URL=sqlite://data/app.db
```

**注意**: `.env`ファイルは`.gitignore`に含まれているため、Gitにはコミットされません。

## データベース同期

ローカルと本番環境のデータベースを同期するには、`scripts/sync-db.sh`スクリプトを使用してください。

### 本番環境からローカルにダウンロード

```bash
cd backend
./scripts/sync-db.sh download
```

これにより、本番環境のデータベースがローカルの`data/app.db`にコピーされます。
既存のデータベースは自動的にバックアップされます。

### ローカルから本番環境にアップロード

```bash
cd backend
./scripts/sync-db.sh upload
```

**警告**: 本番環境のデータベースが上書きされます。確認プロンプトが表示されます。

### アップロード後の再起動

データベースをアップロードした後は、本番環境のアプリケーションを再起動してください：

```bash
flyctl apps restart live-schedule-api
```

