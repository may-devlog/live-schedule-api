# AWS移行計画 - 料金見積もり

## 1. 月額料金の見積もり

### 1.1 小規模運用（初期段階）

| サービス | 仕様 | 月額料金（USD） | 月額料金（円）* |
|---------|------|----------------|----------------|
| **ECS Fargate** | 0.25 vCPU, 0.5GB RAM, 1タスク | $7.50 | ¥1,125 |
| **RDS PostgreSQL** | db.t3.micro (1 vCPU, 1GB RAM) | $15.00 | ¥2,250 |
| **Application Load Balancer** | 1 ALB | $16.20 | ¥2,430 |
| **NAT Gateway** | 1 NAT Gateway | $32.40 | ¥4,860 |
| **データ転送** | 10GB/月 | $0.90 | ¥135 |
| **CloudWatch Logs** | 5GB/月 | $2.50 | ¥375 |
| **ECR** | ストレージ 1GB | $0.10 | ¥15 |
| **Route53** | ホストゾーン 1つ | $0.50 | ¥75 |
| **Secrets Manager** | 1シークレット | $0.40 | ¥60 |
| **合計** | | **$75.50** | **¥11,325** |

*為替レート: 1 USD = 150円で計算

### 1.2 中規模運用（成長段階）

| サービス | 仕様 | 月額料金（USD） | 月額料金（円）* |
|---------|------|----------------|----------------|
| **ECS Fargate** | 0.5 vCPU, 1GB RAM, 2タスク | $30.00 | ¥4,500 |
| **RDS PostgreSQL** | db.t3.small (2 vCPU, 2GB RAM) | $30.00 | ¥4,500 |
| **Application Load Balancer** | 1 ALB | $16.20 | ¥2,430 |
| **NAT Gateway** | 1 NAT Gateway | $32.40 | ¥4,860 |
| **データ転送** | 50GB/月 | $4.50 | ¥675 |
| **CloudWatch Logs** | 20GB/月 | $10.00 | ¥1,500 |
| **ECR** | ストレージ 5GB | $0.50 | ¥75 |
| **Route53** | ホストゾーン 1つ | $0.50 | ¥75 |
| **Secrets Manager** | 1シークレット | $0.40 | ¥60 |
| **合計** | | **$124.50** | **¥18,675** |

### 1.3 大規模運用（本番環境）

| サービス | 仕様 | 月額料金（USD） | 月額料金（円）* |
|---------|------|----------------|----------------|
| **ECS Fargate** | 1 vCPU, 2GB RAM, 3タスク（マルチAZ） | $90.00 | ¥13,500 |
| **RDS PostgreSQL** | db.t3.medium (2 vCPU, 4GB RAM, マルチAZ) | $120.00 | ¥18,000 |
| **Application Load Balancer** | 1 ALB | $16.20 | ¥2,430 |
| **NAT Gateway** | 2 NAT Gateway（マルチAZ） | $64.80 | ¥9,720 |
| **データ転送** | 200GB/月 | $18.00 | ¥2,700 |
| **CloudWatch Logs** | 100GB/月 | $50.00 | ¥7,500 |
| **ECR** | ストレージ 10GB | $1.00 | ¥150 |
| **Route53** | ホストゾーン 1つ | $0.50 | ¥75 |
| **Secrets Manager** | 1シークレット | $0.40 | ¥60 |
| **合計** | | **$360.90** | **¥54,135** |

## 2. 料金の内訳詳細

### 2.1 ECS Fargate

**料金計算:**
- vCPU: $0.04048/vCPU-hour
- メモリ: $0.004445/GB-hour

**例: 0.25 vCPU, 0.5GB RAM, 730時間/月**
- vCPU: 0.25 × $0.04048 × 730 = $7.39
- メモリ: 0.5 × $0.004445 × 730 = $1.62
- **合計: $9.01/月**

### 2.2 RDS PostgreSQL

**db.t3.micro（無料枠対象外の場合）:**
- インスタンス: $0.017/hour × 730時間 = $12.41/月
- ストレージ（20GB gp3）: 20GB × $0.115/GB = $2.30/月
- **合計: $14.71/月**

**db.t3.small:**
- インスタンス: $0.034/hour × 730時間 = $24.82/月
- ストレージ（20GB gp3）: 20GB × $0.115/GB = $2.30/月
- **合計: $27.12/月**

### 2.3 Application Load Balancer

**固定料金:**
- $0.0225/ALB-hour × 730時間 = $16.43/月

**LCU（Load Balancer Capacity Unit）料金:**
- 通常は固定料金に含まれる（小規模の場合）

### 2.4 NAT Gateway

**固定料金:**
- $0.045/Gateway-hour × 730時間 = $32.85/月

**データ処理料金:**
- $0.045/GB（最初の10TB/月）

**注意**: NAT Gatewayは最もコストがかかるコンポーネントの一つです。不要な場合は削除を検討してください。

### 2.5 データ転送

**アウトバウンドデータ転送:**
- 最初の10TB/月: $0.09/GB
- 10TB-40TB/月: $0.085/GB
- 40TB以上/月: $0.05/GB

**同一リージョン内の転送:**
- 通常無料（VPC内、同一AZ間など）

## 3. コスト削減の方法

### 3.1 無料枠の活用（新規アカウント）

**AWS無料利用枠（12ヶ月間）:**
- **RDS**: db.t2.micro（750時間/月）無料
- **データ転送**: 15GB/月無料
- **CloudWatch Logs**: 5GB/月無料

**初年度の節約:**
- RDS: 約$15/月 × 12ヶ月 = $180
- データ転送: 約$1.35/月 × 12ヶ月 = $16.20
- CloudWatch: 約$2.50/月 × 12ヶ月 = $30
- **合計: 約$226.20/年（約¥33,930）**

### 3.2 NAT Gatewayの削減

**オプション1: VPCエンドポイントの使用**
- S3、ECRなどへのアクセスをVPCエンドポイント経由に
- NAT Gatewayが不要になる場合あり
- **節約: $32.40/月（約¥4,860）**

**オプション2: パブリックサブネットでの実行**
- ECSタスクをパブリックサブネットで実行
- セキュリティグループでアクセス制御
- **節約: $32.40/月（約¥4,860）**
- **注意**: セキュリティリスクが増加

### 3.3 リザーブドインスタンス（RDS）

**1年間のリザーブドインスタンス:**
- db.t3.small: 約30%割引
- **節約: 約$9/月（約¥1,350）**

**3年間のリザーブドインスタンス:**
- db.t3.small: 約50%割引
- **節約: 約$15/月（約¥2,250）**

### 3.4 スポットインスタンス（ECS）

**Fargate Spot:**
- 最大70%割引
- **注意**: 中断の可能性あり（本番環境には不向き）

### 3.5 自動スケーリングの最適化

- 使用時間に応じてタスク数を調整
- 夜間や低トラフィック時にタスク数を減らす
- **節約: 20-30%**

## 4. 現在のFly.ioとの比較

### 4.1 Fly.ioの現在の料金

**Fly.io構成:**
- 1 vCPU, 256MB RAM
- Volume: 3GB
- **月額: 約$5-10（¥750-1,500）**

### 4.2 AWS移行によるコスト増加

**小規模運用の場合:**
- **増加額: 約$65-70/月（¥9,750-10,500）**

**理由:**
- より堅牢なインフラ（マルチAZ、自動バックアップ）
- より多くの機能（ALB、CloudWatch、Secrets Manager）
- より高い可用性とスケーラビリティ

## 5. 段階的な移行によるコスト最適化

### 5.1 フェーズ1: 最小構成（検証期間）

- ECS: 1タスク（0.25 vCPU, 0.5GB）
- RDS: db.t3.micro
- NAT Gateway: 1つ
- **月額: 約$75（¥11,250）**

### 5.2 フェーズ2: 本番移行

- ECS: 2タスク（0.5 vCPU, 1GB）
- RDS: db.t3.small
- NAT Gateway: 1つ
- **月額: 約$125（¥18,750）**

### 5.3 フェーズ3: スケールアップ

- ECS: 3タスク（1 vCPU, 2GB）
- RDS: db.t3.medium（マルチAZ）
- NAT Gateway: 2つ（マルチAZ）
- **月額: 約$360（¥54,000）**

## 6. 予算アラートの設定

### 6.1 AWS Budgetsの設定

**AWSマネジメントコンソールでの操作:**

1. **AWS Budgetsダッシュボード**に移動
2. **予算の作成**をクリック
3. 以下の設定を入力：

**予算の設定:**
- **予算タイプ**: コスト予算
- **予算期間**: 毎月
- **予算額**: $100（例）
- **予算名**: `live-schedule-monthly-budget`

**アラート:**
- **実際のコストが予算の80%に達したとき**: 通知
- **実際のコストが予算の100%に達したとき**: 通知
- **予測コストが予算の100%に達したとき**: 通知

**通知先:**
- メールアドレスを入力

## 7. コスト監視のベストプラクティス

### 7.1 リソースタグの設定

すべてのリソースにタグを付与：
- `Project: live-schedule`
- `Environment: production`
- `CostCenter: backend`

### 7.2 Cost Explorerの活用

- **AWS Cost Explorer**でコストを可視化
- サービス別、リージョン別のコスト分析
- トレンドの確認

### 7.3 定期的な見直し

- **月次**: コストレポートの確認
- **四半期**: リソースサイズの見直し
- **年次**: リザーブドインスタンスの検討

## まとめ

### 推奨構成（初期）

- **月額: 約$75-125（¥11,250-18,750）**
- **無料枠活用時: 約$60-110（¥9,000-16,500）**

### コスト削減のポイント

1. ✅ NAT Gatewayの見直し（VPCエンドポイントの活用）
2. ✅ リザーブドインスタンスの検討
3. ✅ 自動スケーリングの最適化
4. ✅ 不要なリソースの削除
5. ✅ 定期的なコスト見直し

### 投資対効果

**追加コストに見合う価値:**
- ✅ 高い可用性（99.99% SLA）
- ✅ 自動バックアップとリカバリ
- ✅ スケーラビリティ
- ✅ セキュリティの強化
- ✅ 監視とアラート機能

---

**注意**: 上記の料金は概算です。実際の使用量やリージョンによって異なる場合があります。最新の料金は[AWS料金ページ](https://aws.amazon.com/jp/pricing/)で確認してください。

