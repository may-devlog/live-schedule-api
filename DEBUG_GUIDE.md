# デバッグガイド - 登録機能

## 問題: 登録ボタンを押しても何も起こらない

### 確認手順

1. **ブラウザの開発者ツールを開く**
   - F12キーを押すか、右クリック → 「検証」
   - 「Console」タブを開く

2. **バックエンドサーバーが起動しているか確認**
   ```bash
   cd backend
   cargo run
   ```
   - `Server running at http://0.0.0.0:3000` が表示されることを確認

3. **フロントエンドサーバーが起動しているか確認**
   ```bash
   cd frontend
   npm start
   ```
   - ブラウザで `http://localhost:8081` が開くことを確認

4. **登録を試行**
   - メールアドレスとパスワードを入力
   - 「登録」ボタンをクリック
   - ブラウザのコンソールにエラーメッセージが表示されないか確認

5. **バックエンドのコンソールを確認**
   - 登録リクエストが届いているか確認
   - エラーメッセージが表示されていないか確認
   - メール送信のログが表示されるか確認

### よくある問題と解決方法

#### 問題1: CORSエラー
**症状**: ブラウザのコンソールに `CORS policy` エラーが表示される

**解決方法**: バックエンドのCORS設定を確認
- `backend/src/main.rs` の `CorsLayer` が正しく設定されているか確認

#### 問題2: ネットワークエラー
**症状**: `Failed to fetch` エラーが表示される

**解決方法**: 
- バックエンドサーバーが起動しているか確認
- `API_BASE` の設定を確認（`frontend/constants/api.ts`）

#### 問題3: バリデーションエラー
**症状**: エラーメッセージが表示される

**解決方法**:
- メールアドレスの形式を確認（`@`と`.`を含む）
- パスワードが6文字以上か確認

#### 問題4: データベースエラー
**症状**: バックエンドのコンソールにデータベースエラーが表示される

**解決方法**:
- データベースファイルが存在するか確認（`backend/data/app.db`）
- データベースのマイグレーションが正しく実行されているか確認

### デバッグ用のログ

現在、以下のログが追加されています：

**フロントエンド**:
- `console.log('Registering user with email:', email)` - 登録開始時
- `console.log('Registration response status:', res.status)` - レスポンスステータス
- `console.error('Registration error:', error)` - エラー発生時

**バックエンド**:
- メール送信時: コンソールにメール内容が表示される
- エラー発生時: エラーメッセージが表示される

### 期待される動作

1. **登録ボタンをクリック**
   - ローディングインジケーターが表示される
   - バックエンドにリクエストが送信される

2. **登録成功時**
   - 「仮登録が完了しました」のアラートが表示される
   - バックエンドのコンソールにメール内容が表示される
   - メール確認画面に遷移する

3. **バックエンドのコンソールに表示される内容**:
   ```
   === メール送信（開発環境） ===
   宛先: test@example.com
   件名: メールアドレスの確認
   本文:
   以下のURLをクリックしてメールアドレスを確認してください:
   http://localhost:8081/verify-email?token=...
   ===========================
   ```

4. **メール確認**
   - バックエンドのコンソールに表示されたURLをブラウザで開く
   - または、メール確認画面でトークンを手動入力

### トラブルシューティング

まだ問題が解決しない場合：

1. **ブラウザのコンソールでエラーを確認**
   - エラーメッセージの全文をコピー
   - エラーの種類を特定

2. **バックエンドのログを確認**
   - リクエストが届いているか
   - エラーが発生しているか

3. **ネットワークタブを確認**
   - 開発者ツールの「Network」タブを開く
   - 登録リクエストを確認
   - ステータスコードを確認（200, 400, 500など）

4. **データベースを確認**
   ```bash
   cd backend
   sqlite3 data/app.db "SELECT * FROM users;"
   ```
   - ユーザーが作成されているか確認

