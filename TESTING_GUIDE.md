# 動作確認ガイド

## 1. バックエンドサーバーの起動

### 初回セットアップ（依存関係のインストール）
```bash
cd backend
cargo build
```

### サーバー起動
```bash
cd backend
cargo run
```

サーバーが起動すると、以下のメッセージが表示されます：
```
Server running at http://0.0.0.0:3000
```

**注意**: バックエンドサーバーは `http://localhost:3000` で動作します。

---

## 2. フロントエンドの起動

### 初回セットアップ（依存関係のインストール）
```bash
cd frontend
npm install
```

### 開発サーバー起動
```bash
cd frontend
npm start
# または
npm run web  # Webブラウザで開く場合
```

ブラウザで `http://localhost:8081` が自動的に開きます（またはターミナルに表示されるURLを開く）。

---

## 3. 動作確認手順

### ステップ1: 新規ユーザー登録

1. アプリを起動すると、ログイン画面が表示されます
2. 「アカウントをお持ちでない方はこちら」をクリック
3. ユーザーIDとパスワードを入力して「登録」をクリック
   - 例: ユーザーID: `testuser`, パスワード: `password123`
4. 登録が成功すると、自動的にログインされ、ホーム画面に遷移します

### ステップ2: ログインの確認

1. 一度ログアウト（後述）して、再度ログイン画面に戻る
2. 登録したユーザーIDとパスワードでログイン
3. ログインが成功すると、ホーム画面に遷移します

### ステップ3: スケジュールの作成

1. ホーム画面から「新規作成」ボタンをクリック
2. 必須項目を入力：
   - タイトル: 例「テストライブ」
   - 都道府県: 例「東京都」
   - 会場名: 例「東京ドーム」
3. その他の項目も必要に応じて入力
4. 「登録」ボタンをクリック
5. スケジュールが作成され、詳細画面に遷移します

### ステップ4: スケジュールの編集と公開設定

1. 作成したスケジュールの詳細画面で「編集」ボタンをクリック
2. 編集画面で「公開」トグルをONにする
3. その他の項目も必要に応じて編集
4. 「更新」ボタンをクリック
5. スケジュールが公開設定になります

### ステップ5: 公開ページの確認

1. ブラウザの新しいタブ（またはシークレットモード）を開く
2. 以下のURLにアクセス：
   ```
   http://localhost:8081/public/[スケジュールID]
   ```
   例: `http://localhost:8081/public/1`
3. **認証なしで**スケジュールの詳細が表示されることを確認
4. 編集ボタンなどは表示されない（閲覧専用）ことを確認

### ステップ6: 認証保護の確認

1. ブラウザの開発者ツールを開く（F12）
2. 「Application」タブ（または「Storage」）→「Local Storage」を開く
3. `@auth_token` を削除（ログアウト状態をシミュレート）
4. ページをリロード
5. ログイン画面にリダイレクトされることを確認

### ステップ7: ログアウト機能の確認

**注意**: 現在、ログアウト機能のUIは実装されていませんが、以下の方法でログアウトできます：

1. ブラウザの開発者ツールを開く
2. 「Application」タブ → 「Local Storage」を開く
3. `@auth_token` と `@auth_user_id` を削除
4. ページをリロードすると、ログイン画面に戻ります

---

## 4. APIエンドポイントの直接確認（オプション）

### ログインAPIの確認
```bash
curl -X POST http://localhost:3000/auth/login \
  -H "Content-Type: application/json" \
  -d '{"user_id":"testuser","password":"password123"}'
```

成功すると、以下のようなレスポンスが返ります：
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user_id": "testuser"
}
```

### 認証が必要なAPIの確認
```bash
# トークンを取得（上記のログインAPIから）
TOKEN="取得したトークン"

# スケジュール一覧を取得
curl -X GET http://localhost:3000/schedules \
  -H "Authorization: Bearer $TOKEN"
```

### 公開APIの確認（認証不要）
```bash
# 公開スケジュール一覧を取得
curl -X GET http://localhost:3000/public/schedules

# 公開スケジュール詳細を取得
curl -X GET http://localhost:3000/public/schedules/1
```

---

## 5. トラブルシューティング

### バックエンドが起動しない
- ポート3000が既に使用されている可能性があります
- 他のプロセスを終了するか、`main.rs`のポート番号を変更してください

### フロントエンドが起動しない
- `node_modules`を削除して再インストール：
  ```bash
  cd frontend
  rm -rf node_modules
  npm install
  ```

### ログインできない
- ユーザーが存在しない場合は、まず登録してください
- パスワードが間違っている場合は、エラーメッセージが表示されます

### 公開ページが表示されない
- スケジュールの`is_public`が`true`になっているか確認してください
- ブラウザのコンソールでエラーメッセージを確認してください

### 認証エラーが発生する
- トークンが期限切れの可能性があります（30日間有効）
- 再度ログインしてください

---

## 6. データベースの確認（オプション）

SQLiteデータベースを直接確認する場合：

```bash
cd backend
sqlite3 data/app.db

# ユーザー一覧を確認
SELECT * FROM users;

# スケジュール一覧を確認
SELECT id, title, user_id, is_public FROM schedules;

# 公開されているスケジュールのみを確認
SELECT id, title, user_id FROM schedules WHERE is_public = 1;
```

---

## 7. 次のステップ

実装が完了した機能：
- ✅ ユーザー登録・ログイン
- ✅ 認証保護されたAPI
- ✅ スケジュールの作成・編集
- ✅ 公開機能
- ✅ 公開ページ（閲覧専用）

今後追加できる機能：
- ログアウトボタンのUI実装
- パスワード変更機能
- ユーザー設定画面
- 公開ページ一覧画面

